<!DOCTYPE html>
<!--
  Author: Bladestar2105
  License: MIT
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPTV-Manager</title>
  <link href="vendor/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
  <style>
    .sortable-ghost {
      opacity: 0.4;
      background: #f0f0f0;
    }
    .sortable-drag {
      opacity: 0.8;
    }
    .drag-handle {
      cursor: move;
      padding: 0 8px;
      color: #999;
    }
    .drag-handle:hover {
      color: #333;
    }
    .lang-switcher {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4" id="main-navbar" style="display: none;">
    <div class="container">
      <a class="navbar-brand" href="#" onclick="return false;">IPTV-Manager</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#" onclick="switchView('dashboard'); return false;" id="nav-dashboard" data-i18n="dashboard">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchView('epg-mapping'); return false;" id="nav-epg-mapping" data-i18n="epgMapping">EPG Mapping</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchView('statistics'); return false;" id="nav-statistics" data-i18n="statistics">Statistics</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchView('security'); return false;" id="nav-security" data-i18n="security">Security</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchView('import-export'); return false;" id="nav-import-export" data-i18n="importExport">Import/Export</a>
          </li>
        </ul>
        <div class="d-flex align-items-center gap-2">
          <select id="language-selector" class="form-select form-select-sm bg-dark text-light border-secondary" style="width:auto;">
            <option value="en">üá¨üáß English</option>
            <option value="de">üá©üá™ Deutsch</option>
            <option value="fr">üá´üá∑ Fran√ßais</option>
            <option value="el">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</option>
          </select>
          <button class="btn btn-outline-info btn-sm" onclick="showChangePasswordModal()" data-i18n="change_password">Change Password</button>
          <button class="btn btn-outline-warning btn-sm" onclick="showOtpModal()" data-i18n="setup_2fa">2FA</button>
          <button class="btn btn-outline-secondary btn-sm" onclick="handleLogout()" data-i18n="logout">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <div class="container py-4" id="main-content" style="display: none;">

    <!-- View: Dashboard -->
    <div id="view-dashboard">
      <!-- Stats Cards -->
      <div class="row mb-4" id="dashboard-stats-bar">
        <div class="col-md-3">
          <div class="card mb-3 text-center">
            <div class="card-body">
              <h5 class="card-title text-muted" data-i18n="totalUsers">Total Users</h5>
              <p class="card-text display-4 fw-bold text-primary" id="stats-users">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 text-center">
            <div class="card-body">
              <h5 class="card-title text-muted" data-i18n="totalProviders">Total Providers</h5>
              <p class="card-text display-4 fw-bold text-success" id="stats-providers">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 text-center">
            <div class="card-body">
              <h5 class="card-title text-muted" data-i18n="activeStreams">Active Streams</h5>
              <p class="card-text display-4 fw-bold text-danger" id="stats-streams">0</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card mb-3 text-center">
            <div class="card-body">
              <h5 class="card-title text-muted" data-i18n="epgSources">EPG Sources</h5>
              <p class="card-text display-4 fw-bold text-info" id="stats-epg">0</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <!-- User List & Selection -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header" data-i18n="userManagement">User Management</div>
            <div class="card-body">
               <form id="user-form" class="row g-2 mb-3">
                  <div class="col-4"><input class="form-control form-control-sm" name="username" data-i18n-placeholder="username" data-i18n-label="username" placeholder="Username" required /></div>
                  <div class="col-4">
                     <div class="input-group input-group-sm">
                        <input class="form-control" name="password" id="new-user-password" type="password" data-i18n-placeholder="password" data-i18n-label="password" placeholder="Password" required />
                        <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('new-user-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
                     </div>
                  </div>
                  <div class="col-2"><button class="btn btn-sm btn-primary w-100" type="submit" data-i18n="addUser">Add</button></div>
                  <div class="col-2"><button class="btn btn-sm btn-outline-secondary w-100" type="button" onclick="generateUser()" data-i18n-title="generateRandomUser" data-i18n-label="generateRandomUser">‚ö°</button></div>
               </form>
               <ul id="user-list" class="list-group list-group-flush" style="max-height: 400px; overflow-y: auto;"></ul>
            </div>
          </div>
        </div>

        <!-- Provider Selection (Visible only when User Selected) -->
        <div class="col-md-6" id="provider-section" style="display:none;">
          <div class="card h-100">
             <div class="card-header" data-i18n="providerManagement">Providers</div>
             <div class="card-body">
                <div id="provider-list-container">
                   <p class="text-muted small" data-i18n="selectUserHint">Providers for selected user:</p>
                   <ul id="provider-list" class="list-group list-group-flush mb-3"></ul>
                   <button id="add-provider-btn" class="btn btn-sm btn-outline-primary w-100" onclick="showAddProviderModal()" data-i18n="addProvider">Add Provider</button>
                </div>
             </div>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Main Content Area -->
        <div class="col-12">
           <!-- Details Panel -->
           <div class="card mb-4">
              <div class="card-header">
                 <span data-i18n="selectedUser">Selected User</span>: <span id="selected-user-label" class="fw-bold">-</span>
              </div>
              <div class="card-body">
                 <!-- Tabs for User Details -->
                 <ul class="nav nav-tabs mb-3" id="user-tabs" role="tablist">
                    <li class="nav-item">
                       <button class="nav-link active" id="tab-channels-btn" data-bs-toggle="tab" data-bs-target="#tab-channels" type="button" data-i18n="channels">Channels</button>
                    </li>
                    <li class="nav-item">
                       <button class="nav-link" id="tab-xtream-btn" data-bs-toggle="tab" data-bs-target="#tab-xtream" type="button" data-i18n="xtreamCodes">Xtream Codes</button>
                    </li>
                    <li class="nav-item">
                       <button class="nav-link" id="tab-hdhr-btn" data-bs-toggle="tab" data-bs-target="#tab-hdhr" type="button">HDHomeRun</button>
                    </li>
                 </ul>

                 <div class="tab-content" id="user-tab-content">
                    <!-- Channels Tab -->
                    <div class="tab-pane fade show active" id="tab-channels">
                       <div class="row">
                          <div class="col-md-5">
                             <h6 data-i18n="categories">Categories</h6>
                             <div class="mb-2">
                                <div class="btn-group btn-group-sm w-100" role="group">
                                   <input type="radio" class="btn-check category-type-filter" name="cat-filter-type" id="cat-filter-live" value="live" checked autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="cat-filter-live" data-i18n="typeLive">Live</label>

                                   <input type="radio" class="btn-check category-type-filter" name="cat-filter-type" id="cat-filter-movie" value="movie" autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="cat-filter-movie" data-i18n="typeMovie">Movies</label>

                                   <input type="radio" class="btn-check category-type-filter" name="cat-filter-type" id="cat-filter-series" value="series" autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="cat-filter-series" data-i18n="typeSeries">Series</label>
                                </div>
                             </div>
                             <form id="category-form" class="input-group input-group-sm mb-2">
                                <input class="form-control" name="name" data-i18n-placeholder="newCategory" data-i18n-label="newCategory" placeholder="New Category" required />
                                <button class="btn btn-outline-secondary" type="submit" data-i18n-label="addCategory" data-i18n-title="addCategory">+</button>
                             </form>
                             <div class="d-flex justify-content-between align-items-center mb-1">
                                <div class="form-check form-check-sm">
                                   <input class="form-check-input" type="checkbox" id="cat-select-all-toggle">
                                   <label class="form-check-label small" for="cat-select-all-toggle" data-i18n="all">All</label>
                                </div>
                                <button class="btn btn-sm btn-danger py-0" id="cat-bulk-delete-btn" style="display:none;" data-i18n="del">Del</button>
                             </div>
                             <ul id="category-list" class="list-group small" style="max-height: 400px; overflow-y: auto;"></ul>
                             <button id="import-categories-btn" class="btn btn-outline-primary btn-sm w-100 mt-2" data-i18n="importCategories">Import Categories</button>
                          </div>
                          <div class="col-md-7">
                             <h6 data-i18n="channels">Channels</h6>
                             <div class="mb-2">
                                <div class="btn-group btn-group-sm w-100" role="group">
                                   <input type="radio" class="btn-check channel-type-filter" name="chan-filter-type" id="chan-filter-live" value="live" checked autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="chan-filter-live" data-i18n="typeLive">Live</label>

                                   <input type="radio" class="btn-check channel-type-filter" name="chan-filter-type" id="chan-filter-movie" value="movie" autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="chan-filter-movie" data-i18n="typeMovie">Movies</label>

                                   <input type="radio" class="btn-check channel-type-filter" name="chan-filter-type" id="chan-filter-series" value="series" autocomplete="off">
                                   <label class="btn btn-outline-secondary" for="chan-filter-series" data-i18n="typeSeries">Series</label>
                                </div>
                             </div>
                             <select id="channel-provider-select" class="form-select form-select-sm mb-2"></select>
                             <div class="input-group input-group-sm mb-2">
                                <input type="text" id="channel-search" class="form-control" data-i18n-placeholder="searchChannels" data-i18n-label="searchChannels" placeholder="Search..." disabled />
                                <button class="btn btn-outline-secondary" type="button" id="channel-search-clear" style="display:none;" aria-label="Clear search">‚úï</button>
                             </div>

                             <div class="row g-2">
                                <div class="col-6">
                                   <div class="border rounded p-1 small text-center" id="available-channels-header">Available</div>
                                   <ul id="provider-channel-list" class="list-group small mt-1" style="max-height: 300px; overflow-y: auto;"></ul>
                                </div>
                                <div class="col-6">
                                   <div class="border rounded p-1 small text-center" id="assigned-channels-header">Assigned</div>
                                   <div class="d-flex justify-content-between align-items-center mb-1 px-1">
                                      <div class="form-check form-check-sm">
                                         <input class="form-check-input" type="checkbox" id="chan-select-all-toggle">
                                      </div>
                                      <button class="btn btn-sm btn-danger py-0" id="chan-bulk-delete-btn" style="display:none;">Del</button>
                                   </div>
                                   <ul id="user-channel-list" class="list-group small mt-1" style="max-height: 300px; overflow-y: auto;"></ul>
                                </div>
                             </div>
                          </div>
                       </div>
                    </div>

                    <!-- Xtream Codes Tab -->
                    <div class="tab-pane fade" id="tab-xtream">
                       <div class="mb-2">
                          <label class="form-label small fw-bold" data-i18n="url">URL</label>
                          <div class="input-group input-group-sm">
                             <input type="text" class="form-control" id="xtream-url" readonly>
                             <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('xtream-url').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                          </div>
                       </div>

                       <div class="row g-2 mb-2">
                          <div class="col-md-6">
                             <label class="form-label small fw-bold" data-i18n="username">Username</label>
                             <div class="input-group input-group-sm">
                                <input type="text" class="form-control" id="xtream-user" readonly>
                                <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('xtream-user').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                             </div>
                          </div>
                          <div class="col-md-6">
                             <label class="form-label small fw-bold" data-i18n="password">Password</label>
                             <div class="input-group input-group-sm">
                                <input type="password" class="form-control" id="xtream-pass" readonly>
                                <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('xtream-pass').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                             </div>
                          </div>
                       </div>

                       <div class="mb-2">
                          <label class="form-label small fw-bold" data-i18n="epgUrlLabel">EPG URL</label>
                          <div class="input-group input-group-sm">
                             <input type="text" class="form-control" id="epg-url" readonly>
                             <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('epg-url').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                          </div>
                       </div>

                       <div class="mb-3">
                          <label class="form-label small fw-bold" data-i18n="m3uLink">M3U Link</label>
                          <div class="input-group input-group-sm">
                             <input type="text" class="form-control" id="m3u-link" readonly>
                             <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('m3u-link').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                          </div>
                       </div>

                       <button class="btn btn-primary w-100" onclick="copyAllXtreamCredentials(this)" data-i18n="copyAll">Copy All Credentials</button>
                    </div>

                    <!-- HDHomeRun Tab -->
                    <div class="tab-pane fade" id="tab-hdhr">
                       <div id="hdhr-enabled-section" style="display:none;">
                          <div class="alert alert-info small">
                             Use the URL below to configure Plex DVR or Emby Live TV.
                             <br><strong>Note:</strong> This feature emulates an HDHomeRun tuner.
                          </div>
                          <div class="mb-3">
                             <label class="form-label small fw-bold">Device URL</label>
                             <div class="input-group input-group-sm">
                                <input type="text" class="form-control" id="hdhr-url" readonly>
                                <button class="btn btn-outline-secondary" onclick="copyToClipboard(document.getElementById('hdhr-url').value, this)" data-i18n-label="copyToClipboardAction" data-i18n-title="copyToClipboardAction">üìã</button>
                             </div>
                          </div>
                       </div>
                       <div id="hdhr-disabled-section" style="display:none;">
                          <div class="alert alert-warning small">
                             HDHomeRun emulation is disabled for this user.
                             <br>Enable it in the <strong>Edit User</strong> menu.
                          </div>
                       </div>
                    </div>
                 </div>
              </div>
           </div>
        </div>
      </div>
      
      <div class="card mt-4" id="epg-sources-card">
         <div class="card-header d-flex justify-content-between align-items-center">
            <span data-i18n="epgSources">EPG Sources</span>
            <div>
               <button id="add-epg-source-btn" class="btn btn-sm btn-primary" data-i18n-label="addEpgSource" data-i18n-title="addEpgSourceTitle">+</button>
               <button id="browse-epg-sources-btn" class="btn btn-sm btn-secondary" data-i18n="browse">Browse</button>
               <button id="update-all-epg-btn" class="btn btn-sm btn-info" data-i18n="updateAll">Update All</button>
            </div>
         </div>
         <div class="card-body">
            <ul id="epg-sources-list" class="list-group list-group-flush"></ul>
         </div>
      </div>

    </div> <!-- End view-dashboard -->

    <!-- View: Security -->
    <div id="view-security" class="d-none">
      <!-- Settings -->
      <div class="card mb-4">
         <div class="card-header" data-i18n="settings">Settings</div>
         <div class="card-body">
            <form id="security-settings-form">
               <div class="row mb-3">
                  <div class="col-md-6">
                     <label class="form-label" data-i18n="adminBlockThreshold">Admin Block Threshold (attempts)</label>
                     <input type="number" class="form-control" name="admin_block_threshold" id="setting-admin-threshold" placeholder="5">
                  </div>
                  <div class="col-md-6">
                     <label class="form-label" data-i18n="iptvBlockThreshold">IPTV Block Threshold (attempts)</label>
                     <input type="number" class="form-control" name="iptv_block_threshold" id="setting-iptv-threshold" placeholder="10">
                  </div>
               </div>
               <div class="row mb-3">
                  <div class="col-md-6">
                     <label class="form-label" data-i18n="adminBlockDuration">Admin Block Duration (seconds)</label>
                     <input type="number" class="form-control" name="admin_block_duration" id="setting-admin-duration" placeholder="3600">
                  </div>
                  <div class="col-md-6">
                     <label class="form-label" data-i18n="iptvBlockDuration">IPTV Block Duration (seconds)</label>
                     <input type="number" class="form-control" name="iptv_block_duration" id="setting-iptv-duration" placeholder="3600">
                  </div>
               </div>
               <!-- Hidden field to maintain backward compatibility if needed, or we can just ignore it -->
               <!-- <input type="hidden" name="ip_block_duration" id="setting-block-duration"> -->

               <button class="btn btn-primary" type="submit" data-i18n="save">Save</button>
            </form>
         </div>
      </div>

      <div class="row mb-4">
         <div class="col-md-6">
            <h5 data-i18n="blockIp">Block IP</h5>
            <form id="block-ip-form" class="d-flex gap-2 mb-2 align-items-center">
               <input class="form-control form-control-sm" name="ip" data-i18n-label="ip" placeholder="IP Address" required style="width: 150px;">
               <input class="form-control form-control-sm" name="reason" data-i18n-placeholder="whitelistReason" data-i18n-label="whitelistReason" placeholder="Reason" style="flex-grow: 1;">
               <select class="form-select form-select-sm" name="duration" style="width: auto;">
                  <option value="3600">1h</option>
                  <option value="21600">6h</option>
                  <option value="43200">12h</option>
                  <option value="86400">24h</option>
                  <option value="manual" data-i18n="custom">Custom</option>
               </select>
               <button class="btn btn-sm btn-danger" data-i18n="block">Block</button>
            </form>
            <ul id="blocked-ip-list" class="list-group small" style="max-height: 200px; overflow:auto;"></ul>
         </div>
         <div class="col-md-6">
            <h5 data-i18n="whitelistIp">Whitelist IP</h5>
            <form id="whitelist-ip-form" class="d-flex gap-2 mb-2">
               <input class="form-control form-control-sm" name="ip" data-i18n-label="ip" placeholder="IP Address" required>
               <input class="form-control form-control-sm" name="description" data-i18n-placeholder="reasonPlaceholder" data-i18n-label="whitelistReason" placeholder="Reason">
               <button class="btn btn-sm btn-success" data-i18n="whitelist">Whitelist</button>
            </form>
            <ul id="whitelisted-ip-list" class="list-group small" style="max-height: 200px; overflow:auto;"></ul>
         </div>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-2">
         <h5 data-i18n="securityLogs">Security Logs</h5>
         <button class="btn btn-sm btn-outline-danger" onclick="clearSecurityLogs()" data-i18n="clearLogs">Clear Logs</button>
      </div>
      <div class="card mb-4">
        <div class="card-body p-0 table-responsive" style="max-height: 300px;">
          <table class="table table-sm table-striped mb-0 small">
             <thead>
               <tr>
                 <th data-i18n="time">Time</th>
                 <th data-i18n="ip">IP</th>
                 <th data-i18n="action">Action</th>
                 <th data-i18n="details">Details</th>
               </tr>
             </thead>
             <tbody id="security-logs-tbody">
                <tr><td colspan="4" class="text-center text-muted" data-i18n="loading">Loading...</td></tr>
             </tbody>
          </table>
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-2">
         <h5 data-i18n="clientLogs">Client Logs</h5>
         <button class="btn btn-sm btn-outline-danger" onclick="clearClientLogs()" data-i18n="clearLogs">Clear Logs</button>
      </div>
      <div class="card">
        <div class="card-body p-0 table-responsive" style="max-height: 300px;">
          <table class="table table-sm table-striped mb-0 small">
             <thead>
               <tr>
                 <th data-i18n="time">Time</th>
                 <th data-i18n="level">Level</th>
                 <th data-i18n="message">Message</th>
                 <th data-i18n="details">Details</th>
               </tr>
             </thead>
             <tbody id="client-logs-tbody">
                <tr><td colspan="4" class="text-center text-muted" data-i18n="loading">Loading...</td></tr>
             </tbody>
          </table>
        </div>
      </div>

    </div>

    <!-- View: Import/Export -->
    <div id="view-import-export" class="d-none">
      <div class="row mt-4">
        <!-- Export Card -->
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-header" data-i18n="exportData">Export Data</div>
            <div class="card-body">
              <p class="text-muted small" data-i18n="exportDescription">Export users, providers, and configurations to a secure file.</p>

              <form id="export-form">
                <div class="mb-3">
                  <label class="form-label" data-i18n="selectUserExport">Select User to Export</label>
                  <select class="form-select" id="export-user-select" name="user_id">
                    <option value="all" data-i18n="allUsers">All Users</option>
                    <!-- Populated by JS -->
                  </select>
                </div>

                <div class="mb-3">
                  <label class="form-label" data-i18n="encryptionPassword">Encryption Password</label>
                  <input type="password" class="form-control" name="password" required minlength="8" data-i18n-placeholder="passwordPlaceholder">
                  <div class="form-text" data-i18n="encryptionPasswordHint">This password will be required to decrypt and import the data.</div>
                </div>

                <button type="submit" class="btn btn-primary w-100" id="export-btn" data-i18n="exportBtn">Export Data</button>
              </form>
            </div>
          </div>
        </div>

        <!-- Import Card -->
        <div class="col-md-6 mb-4">
          <div class="card h-100">
            <div class="card-header" data-i18n="importData">Import Data</div>
            <div class="card-body">
              <p class="text-muted small" data-i18n="importDescription">Import data from a previously exported file.</p>

              <form id="import-form">
                <div class="mb-3">
                  <label class="form-label" data-i18n="fileSelect">Select File</label>
                  <input type="file" class="form-control" name="file" required accept=".bin">
                </div>

                <div class="mb-3">
                  <label class="form-label" data-i18n="decryptionPassword">Decryption Password</label>
                  <input type="password" class="form-control" name="password" required data-i18n-placeholder="passwordPlaceholder">
                </div>

                <button type="submit" class="btn btn-warning w-100" id="import-btn" data-i18n="importBtn">Import Data</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- View: Statistics -->
    <div id="view-statistics" class="d-none">
      <div class="row mt-4">
        <!-- Active Streams -->
        <div class="col-md-6 mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
             <h3 data-i18n="activeStreams" class="m-0 border-0">Active Streams</h3>
             <span class="badge bg-primary" id="active-stream-count">0</span>
          </div>
          <div class="table-responsive" style="max-height: 400px; border: 1px solid var(--tv-border); border-radius: 8px;">
              <table class="table table-striped mb-0 small">
                <thead>
                  <tr>
                    <th data-i18n="username">User</th>
                    <th data-i18n="channelName">Channel</th>
                    <th data-i18n="duration">Time</th>
                    <th data-i18n="ip">IP</th>
                  </tr>
                </thead>
                <tbody id="active-streams-tbody">
                   <tr><td colspan="4" class="text-center text-muted" data-i18n="loading">Loading...</td></tr>
                </tbody>
              </table>
          </div>
        </div>

        <!-- Top Channels -->
        <div class="col-md-6 mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
             <h3 data-i18n="topChannels" class="m-0 border-0">Top Channels</h3>
             <button id="reset-stats-btn" class="btn btn-sm btn-outline-danger" data-i18n="resetStats">Reset</button>
          </div>
          <div class="table-responsive" style="max-height: 400px; border: 1px solid var(--tv-border); border-radius: 8px;">
              <table class="table table-striped mb-0 small">
                <thead>
                  <tr>
                    <th>#</th>
                    <th data-i18n="channelName">Channel</th>
                    <th data-i18n="streamCount">Viewers</th>
                    <th data-i18n="lastViewed">Last Viewed</th>
                  </tr>
                </thead>
                <tbody id="top-channels-tbody">
                   <tr><td colspan="4" class="text-center text-muted" data-i18n="loading">Loading...</td></tr>
                </tbody>
              </table>
          </div>
        </div>
      </div>
    </div> <!-- End view-statistics -->

    <!-- View: EPG Mapping -->
    <div id="view-epg-mapping" class="d-none">
      <h3 data-i18n="configuration" class="mt-4">Configuration</h3>

      <!-- Mode Switcher -->
      <div class="mb-3" id="epg-mode-switcher" style="display:none;">
         <div class="btn-group" role="group">
            <input type="radio" class="btn-check" name="epg-mode" id="epg-mode-provider" value="provider" checked>
            <label class="btn btn-outline-primary" for="epg-mode-provider" data-i18n="modeProvider">By Provider</label>

            <input type="radio" class="btn-check" name="epg-mode" id="epg-mode-category" value="category">
            <label class="btn btn-outline-primary" for="epg-mode-category" data-i18n="modeCategory">By Category</label>
         </div>
      </div>

      <!-- Provider Controls -->
      <div id="epg-mapping-provider-container">
          <div class="row align-items-end mb-4">
            <div class="col-md-5">
              <label class="form-label" data-i18n="selectProvider">Select Provider</label>
              <select id="epg-mapping-provider-select" class="form-select">
                <option value="" data-i18n="selectProviderPlaceholder">-- Select Provider --</option>
              </select>
            </div>
            <div class="col-md-7 text-end">
              <div class="d-flex justify-content-end align-items-center gap-3">
                 <div class="form-check" id="only-used-container" style="display:none;">
                   <input class="form-check-input" type="checkbox" id="epg-only-used">
                   <label class="form-check-label" for="epg-only-used" data-i18n="only_used_channels">Only used channels</label>
                 </div>
                 <button id="auto-map-btn" class="btn btn-warning" disabled data-i18n="autoMap">‚ö° Auto Map</button>
                 <button id="reset-map-btn" class="btn btn-danger ms-2" style="display:none;" data-i18n="resetMapping">Reset Mapping</button>
              </div>
            </div>
          </div>
      </div>

      <!-- Category Controls -->
      <div id="epg-mapping-category-container" style="display:none;">
          <div class="row align-items-end mb-4">
            <div class="col-md-4" id="epg-category-user-select-container">
               <label class="form-label" data-i18n="selectUser">Select User</label>
               <select id="epg-mapping-user-select" class="form-select">
                  <!-- Populated by JS -->
               </select>
            </div>
            <div class="col-md-4">
              <label class="form-label" data-i18n="selectCategory">Select Category</label>
              <select id="epg-mapping-category-select" class="form-select">
                <option value="" data-i18n="selectCategoryPlaceholder">-- Select Category --</option>
              </select>
            </div>
          </div>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-2">
         <h3 data-i18n="channelMappingList" class="m-0 border-0">Channel List</h3>
         <div class="input-group input-group-sm" style="width: 250px;">
            <input type="text" id="epg-mapping-search" class="form-control" data-i18n-placeholder="searchChannels" data-i18n-label="searchChannels" placeholder="Search channels...">
            <button class="btn btn-outline-secondary" type="button" id="epg-mapping-search-clear" style="display:none;" aria-label="Clear search">‚úï</button>
         </div>
      </div>

      <div class="table-responsive" style="max-height: 600px; border: 1px solid var(--tv-border); border-radius: 8px;">
        <table class="table table-striped table-hover mb-0 sticky-top-header">
          <thead>
            <tr>
              <th style="width: 5%">#</th>
              <th style="width: 30%" data-i18n="channelName">Channel</th>
              <th style="width: 25%" data-i18n="currentEpgId">Current EPG ID</th>
              <th style="width: 25%" data-i18n="manualMapping">Manual Mapping</th>
              <th style="width: 15%" data-i18n="actions">Actions</th>
            </tr>
          </thead>
          <tbody id="epg-mapping-tbody">
             <tr><td colspan="5" class="text-center p-4 text-muted" data-i18n="selectProviderFirst">Please select a provider first</td></tr>
          </tbody>
        </table>
      </div>
      <div class="text-muted small mt-2">
        <span id="mapping-stats"></span>
      </div>
    </div> <!-- End view-epg-mapping -->

  </div>

  <!-- Category Import Modal -->
  <div class="modal fade" id="importCategoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="importCategoriesTitle">Import Provider Categories</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3 d-flex gap-2 justify-content-center">
             <div class="form-check">
               <input class="form-check-input import-type-radio" type="radio" name="import-type" id="import-type-live" value="live" checked>
               <label class="form-check-label" for="import-type-live" data-i18n="typeLive">Live</label>
             </div>
             <div class="form-check">
               <input class="form-check-input import-type-radio" type="radio" name="import-type" id="import-type-movie" value="movie">
               <label class="form-check-label" for="import-type-movie" data-i18n="typeMovie">Movies</label>
             </div>
             <div class="form-check">
               <input class="form-check-input import-type-radio" type="radio" name="import-type" id="import-type-series" value="series">
               <label class="form-check-label" for="import-type-series" data-i18n="typeSeries">Series</label>
             </div>
          </div>
          <div class="input-group input-group-sm mb-3">
             <input type="text" id="category-import-search" class="form-control" data-i18n-placeholder="searchCategories" data-i18n-label="searchCategories" placeholder="üîç Search categories..." />
             <button class="btn btn-outline-secondary" type="button" id="category-import-search-clear" style="display:none;" aria-label="Clear search">‚úï</button>
          </div>
          <div class="d-flex justify-content-between mb-2">
             <div>
               <button class="btn btn-sm btn-outline-secondary" id="cat-select-all" data-i18n="selectAll">Select All</button>
               <button class="btn btn-sm btn-outline-secondary" id="cat-deselect-all" data-i18n="deselectAll">Deselect All</button>
             </div>
             <div>
               <span id="cat-selected-count" class="badge bg-info">0</span>
             </div>
          </div>
          <ul id="provider-categories-list" class="list-group" style="max-height:400px; overflow:auto;">
            <li class="list-group-item text-muted" data-i18n="loadingCategories">Loading categories...</li>
          </ul>
        </div>
        <div class="modal-footer">
          <div class="d-flex gap-2 w-100 justify-content-end">
             <button type="button" class="btn btn-primary" id="btn-import-selected" data-i18n="importSelected">Import Selected</button>
             <button type="button" class="btn btn-success" id="btn-import-selected-channels" data-i18n="importSelectedWithChannels">Import Selected w/ Channels</button>
             <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sync Config Modal -->
  <div class="modal fade" id="sync-config-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="syncConfig">Sync Configuration</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="sync-config-form">
          <div class="modal-body">
            <input type="hidden" id="sync-provider-id" name="provider_id">
            <input type="hidden" id="sync-user-id" name="user_id">
            
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="sync-enabled" checked>
                <label class="form-check-label" for="sync-enabled" data-i18n="enableAutomaticSync">Enable Automatic Sync</label>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="sync-interval" class="form-label" data-i18n="syncInterval">Sync Interval</label>
              <select class="form-select" id="sync-interval" name="sync_interval">
                <option value="hourly" data-i18n="hourly">Every Hour</option>
                <option value="every_6_hours" data-i18n="every_6_hours">Every 6 Hours</option>
                <option value="every_12_hours" data-i18n="every_12_hours">Every 12 Hours</option>
                <option value="daily" selected data-i18n="daily">Daily</option>
                <option value="weekly" data-i18n="weekly">Weekly</option>
              </select>
            </div>
            
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="sync-auto-categories" checked>
                <label class="form-check-label" for="sync-auto-categories" data-i18n="autoAddNewCategories">
                  Auto-add new categories
                </label>
              </div>
            </div>
            
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="sync-auto-channels" checked>
                <label class="form-check-label" for="sync-auto-channels" data-i18n="autoAddChannelsToCategories">
                  Auto-add channels to categories
                </label>
              </div>
            </div>
            
            <div id="last-sync-info" class="alert alert-info" style="display:none;"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
            <button type="submit" class="btn btn-primary" data-i18n="saveConfiguration">Save Configuration</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Sync Logs Modal -->
  <div class="modal fade" id="sync-logs-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="syncLogs">Sync Logs</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table class="table table-sm table-striped">
              <thead>
                <tr>
                  <th data-i18n="time">Time</th>
                  <th data-i18n="status">Status</th>
                  <th data-i18n="added">Added</th>
                  <th data-i18n="updated">Updated</th>
                  <th data-i18n="categories">Categories</th>
                  <th data-i18n="error">Error</th>
                </tr>
              </thead>
              <tbody id="sync-logs-tbody">
                <tr><td colspan="6" class="text-center">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add EPG Source Modal -->
  <div class="modal fade" id="add-epg-source-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="addEpgSourceTitle">Add EPG Source</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="add-epg-source-form">
          <div class="modal-body">
            <div class="mb-3">
              <label for="epg-source-name" class="form-label" data-i18n="name">Name</label>
              <input type="text" class="form-control" id="epg-source-name" required>
            </div>
            <div class="mb-3">
              <label for="epg-source-url" class="form-label" data-i18n="url">URL</label>
              <input type="url" class="form-control" id="epg-source-url" required>
            </div>
            <div class="mb-3">
              <label for="epg-update-interval" class="form-label" data-i18n="updateInterval">Update Interval</label>
              <select class="form-select" id="epg-update-interval">
                <option value="3600" data-i18n="interval_1h">1 hour</option>
                <option value="21600" data-i18n="interval_6h">6 hours</option>
                <option value="43200" data-i18n="interval_12h">12 hours</option>
                <option value="86400" selected data-i18n="interval_24h">24 hours</option>
                <option value="604800" data-i18n="interval_7d">7 days</option>
              </select>
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="epg-source-enabled" checked>
                <label class="form-check-label" for="epg-source-enabled" data-i18n="enabled">
                  Enabled
                </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
            <button type="submit" class="btn btn-primary" data-i18n="addSource">Add Source</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit EPG Source Modal -->
  <div class="modal fade" id="edit-epg-source-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="editEpgSourceTitle">Edit EPG Source</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="edit-epg-source-form">
          <div class="modal-body">
            <input type="hidden" id="edit-epg-source-id">
            <div class="mb-3">
              <label for="edit-epg-source-name" class="form-label" data-i18n="name">Name</label>
              <input type="text" class="form-control" id="edit-epg-source-name" required>
            </div>
            <div class="mb-3">
              <label for="edit-epg-source-url" class="form-label" data-i18n="url">URL</label>
              <input type="url" class="form-control" id="edit-epg-source-url" required>
            </div>
            <div class="mb-3">
              <label for="edit-epg-update-interval" class="form-label" data-i18n="updateInterval">Update Interval</label>
              <select class="form-select" id="edit-epg-update-interval">
                <option value="3600" data-i18n="interval_1h">1 hour</option>
                <option value="21600" data-i18n="interval_6h">6 hours</option>
                <option value="43200" data-i18n="interval_12h">12 hours</option>
                <option value="86400" data-i18n="interval_24h">24 hours</option>
                <option value="604800" data-i18n="interval_7d">7 days</option>
              </select>
            </div>
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="edit-epg-source-enabled">
                <label class="form-check-label" for="edit-epg-source-enabled" data-i18n="enabled">
                  Enabled
                </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
            <button type="submit" class="btn btn-primary" data-i18n="saveChanges">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Browse EPG Sources Modal -->
  <div class="modal fade" id="browse-epg-sources-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="browseEpgSourcesTitle">Browse Available EPG Sources</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="input-group input-group-sm mb-3">
             <input type="text" id="epg-browse-search" class="form-control" data-i18n-placeholder="searchEpgSources" placeholder="üîç Search sources...">
             <button class="btn btn-outline-secondary" type="button" id="epg-browse-search-clear" style="display:none;" aria-label="Clear search">‚úï</button>
          </div>
          <ul id="available-epg-sources-list" class="list-group" style="max-height:400px; overflow:auto;">
            <li class="list-group-item text-muted" data-i18n="loading">Loading...</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div class="modal fade" id="login-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="login">Login</h5>
        </div>
        <div class="modal-body">
          <form id="login-form" onsubmit="handleLogin(event)">
            <div class="mb-3">
              <label for="login-username" class="form-label" data-i18n="username">Username</label>
              <input type="text" class="form-control" id="login-username" required>
            </div>
            <div class="mb-3">
              <label for="login-password" class="form-label" data-i18n="password">Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="login-password" required>
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('login-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
              </div>
            </div>
            <div class="mb-3" id="login-otp-group" style="display:none;">
              <label for="login-otp" class="form-label" data-i18n="otp_code">2FA Code</label>
              <input type="text" class="form-control" id="login-otp" autocomplete="off" data-i18n-placeholder="otpPlaceholder" placeholder="123456">
            </div>
            <div id="login-error" class="alert alert-danger" style="display: none;"></div>
            <button type="submit" class="btn btn-primary w-100" id="login-btn" data-i18n="login">Login</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- OTP Modal -->
  <div class="modal fade" id="otp-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="setup_2fa">Two-Factor Authentication</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="otp-setup-step-1">
             <div class="text-center mb-3">
                <img id="otp-qr-code" src="" alt="QR Code" class="img-fluid" style="display:none; max-width: 200px;">
                <div id="otp-secret-text" class="mt-2 text-muted small"></div>
             </div>
             <p data-i18n="scan_qr">Scan the QR code with your authenticator app (Google Authenticator, Authy, etc.)</p>
             <div class="input-group mb-3">
                <input type="text" id="otp-verify-input" class="form-control" data-i18n-placeholder="otpPlaceholder" placeholder="123456">
                <button class="btn btn-primary" onclick="verifyAndEnableOtp()" data-i18n="verify">Verify</button>
             </div>
          </div>

          <div id="otp-status-active" style="display:none;" class="text-center">
             <div class="alert alert-success" data-i18n="2fa_enabled">2FA is currently enabled on your account.</div>
             <button class="btn btn-danger" onclick="disableOtp()" data-i18n="disable_2fa">Disable 2FA</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal fade" id="edit-user-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="editUser">Edit User</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="edit-user-form">
          <div class="modal-body">
            <input type="hidden" id="edit-user-id">
            <div class="mb-3">
              <label class="form-label" data-i18n="username">Username</label>
              <input type="text" class="form-control" id="edit-user-username" required>
            </div>
            <div class="mb-3">
              <label class="form-label" data-i18n="new_password">New Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="edit-user-password" data-i18n-placeholder="leaveBlankToKeep" placeholder="Leave blank to keep current">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('edit-user-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
              </div>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="edit-user-webui-access">
              <label class="form-check-label" for="edit-user-webui-access" data-i18n="webui_access">Web UI Access</label>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="edit-user-hdhr-enabled">
              <label class="form-check-label" for="edit-user-hdhr-enabled">Enable HDHomeRun</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
            <button type="submit" class="btn btn-primary" data-i18n="saveChanges">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="change-password-modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="change_password">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="change-password-form" onsubmit="handleChangePassword(event)">
            <div class="mb-3">
              <label for="old-password" class="form-label" data-i18n="old_password">Old Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="old-password" required>
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('old-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
              </div>
            </div>
            <div class="mb-3">
              <label for="new-password" class="form-label" data-i18n="new_password">New Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="new-password" required minlength="8">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('new-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
              </div>
              <small class="form-text text-secondary" data-i18n="password_min_length">Minimum 8 characters</small>
            </div>
            <div class="mb-3">
              <label for="confirm-password" class="form-label" data-i18n="confirm_password">Confirm Password</label>
              <div class="input-group">
                <input type="password" class="form-control" id="confirm-password" required minlength="8">
                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('confirm-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
              </div>
            </div>
            <div id="change-password-error" class="alert alert-danger" style="display: none;"></div>
            <div id="change-password-success" class="alert alert-success" style="display: none;"></div>
            <button type="submit" class="btn btn-primary w-100" id="change-password-btn" data-i18n="change_password">Change Password</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Provider Modal -->
  <div class="modal fade" id="add-provider-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="addProvider">Add Provider</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <form id="provider-form">
          <div class="modal-body">
             <input type="hidden" name="provider_id" value="">
             <!-- Hidden user_id, set by JS -->
             <input type="hidden" name="user_id" value="">

             <div class="row mb-3">
                <div class="col-md-6">
                   <label class="form-label" data-i18n="name">Name</label>
                   <input class="form-control" name="name" required>
                </div>
                <div class="col-md-6">
                   <label class="form-label" data-i18n="url">URL</label>
                   <input class="form-control" name="url" placeholder="http://..." required>
                </div>
             </div>
             <div class="row mb-3">
                <div class="col-md-6">
                   <label class="form-label" data-i18n="username">Username</label>
                   <input class="form-control" name="username" required>
                </div>
                <div class="col-md-6">
                   <label class="form-label" data-i18n="password">Password</label>
                   <div class="input-group">
                     <input class="form-control" name="password" id="provider-password" type="password" required>
                     <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('provider-password', this)" data-i18n-label="show_password" data-i18n-title="show_password">üëÅÔ∏è</button>
                   </div>
                </div>
             </div>
             <div class="mb-3">
                <label class="form-label" data-i18n="epgUrl">EPG URL</label>
                <input class="form-control" name="epg_url" data-i18n-placeholder="optional" placeholder="(Optional)">
             </div>
             <div class="mb-3">
                <label class="form-label" data-i18n="expiryDate">Expiry Date</label>
                <input class="form-control" id="provider-expiry-date" readonly disabled>
             </div>
             <div class="row">
                <div class="col-md-6">
                   <div class="form-check mt-4">
                      <input class="form-check-input" type="checkbox" name="epg_enabled" id="prov-epg-enabled" checked>
                      <label class="form-check-label" for="prov-epg-enabled" data-i18n="enableEpg">Enable EPG</label>
                   </div>
                </div>
                <div class="col-md-6">
                   <label class="form-label" data-i18n="updateInterval">Update Interval</label>
                   <select class="form-select" name="epg_update_interval">
                        <option value="3600">1h</option>
                        <option value="21600">6h</option>
                        <option value="43200">12h</option>
                        <option value="86400" selected>24h</option>
                   </select>
                </div>
             </div>
          </div>
          <div class="modal-footer">
             <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
             <button type="submit" class="btn btn-primary" id="save-provider-btn" data-i18n="save">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- EPG Channel Select Modal -->
  <div class="modal fade" id="epg-select-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n="selectEpgChannel">Select EPG Channel</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="input-group input-group-sm mb-3">
             <input type="text" id="epg-select-search" class="form-control" data-i18n-placeholder="searchChannels" data-i18n-label="searchChannels" placeholder="Search EPG channels...">
             <button class="btn btn-outline-secondary" type="button" id="epg-select-search-clear" style="display:none;" aria-label="Clear search">‚úï</button>
          </div>
          <ul id="epg-select-list" class="list-group" style="max-height:400px; overflow:auto;">
             <li class="list-group-item text-center text-muted">Loading...</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="close">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="vendor/bootstrap.bundle.min.js"></script>
  <script src="vendor/sortable.min.js"></script>
  <script src="i18n.js"></script>
  <script src="app.js"></script>

  <!-- Toast Container -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container" style="z-index: 1100;"></div>
</body>
</html>
