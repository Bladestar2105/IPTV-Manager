## 2026-03-02 - SQLite JSON Aggregation for Large Datasets
**Learning:** Returning thousands of individual rows from `better-sqlite3` and iterating over them in Node.js to construct complex nested JSON objects (like the EPG schedule map) is memory intensive and significantly slower than offloading the JSON construction to SQLite. However, when using `json_group_array`, SQLite does not guarantee the order of elements within the array unless the grouping is applied to an already-sorted dataset (using a subquery with `ORDER BY`).
**Action:** Use `json_group_array(json_object(...))` in SQLite queries to aggregate large collections. If order matters (e.g., chronological EPG events), ensure you select from a subquery that has the `ORDER BY` applied before the outer grouping query. Always benchmark optimizations before committing, as SQLite JSON performance vs. Node.js native object creation can vary based on dataset size.