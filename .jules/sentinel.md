## 2024-05-23 - SSRF in HLS Segment Proxy
**Vulnerability:** The `proxySegment` endpoint in `streamController.js` accepted a target URL via an encrypted payload but did not validate it against private IPs. This allowed a malicious or compromised upstream provider to inject private IP URLs into their HLS playlist, causing the server to proxy requests to its own local network (SSRF).
**Learning:** Encryption only ensures integrity and authenticity of the payload (that it was generated by us), but it does not guarantee that the *data inside* (which originated from the upstream provider's playlist) is safe. We must treat data from external providers as untrusted, even if we wrapped it ourselves.
**Prevention:** Always validate URLs against SSRF (using `isSafeUrl` or similar) right before making the request. When supporting legitimate private upstreams, use an explicit "allow" flag derived from the trusted admin configuration (the provider's base URL) rather than disabling protection globally or blindly trusting the payload.
